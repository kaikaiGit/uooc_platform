<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>设置新密码</title>
    <link rel="stylesheet" href="account-login.css">
</head>
<body>
    <div class="container">
        <h2>设置新密码</h2>
        <form id="set-new-password-form">
            <div class="input-group">
                <label for="password">新密码</label>
                <input type="password" id="password" placeholder="输入新密码" required>
                <span id="pa-error-message" class="error-message"></span>
            </div>
            <div class="input-group">
                <label for="confirm-password">确认新密码</label>
                <input type="password" id="confirm-password" placeholder="再次输入新密码" required>
                <span id="cp-error-message" class="error-message"></span>
            </div>
            <button type="submit" class="button">确认</button>
            <div id="success-message" class="success-message"></div>
        </form>
    </div>
    <script src="../database.js"></script>
    <script src="account.js"></script>
    <script>
        //当离开密码输入框时，验证是否填写密码
        document.getElementById('password').addEventListener('blur', () => {
            checkPassword();
        });
        //当离开确认密码输入框时，验证是否填写确认密码
        document.getElementById('confirm-password').addEventListener('blur', () => {
            checkConfirmPassword();
        });
        document.getElementById('set-new-password-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const userid = localStorage.getItem('resetPassword');
            let password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            //检验是否填写信息
            if (!checkPassword() || !checkConfirmPassword()) {
                return;
            }
            //验证密码和确认密码是否一致
            if (password !== confirmPassword) {
                //在pa-error-message中显示错误信息
                document.getElementById('cp-error-message').textContent = '密码不一致，请重新输入';
                return;
            }
            //清空错误信息
            document.getElementById('pa-error-message').textContent = '';
            document.getElementById('cp-error-message').textContent = '';
            //加盐哈希加密密码
            password = simpleHash(password, userid);
            //将新密码存入localstorage
            let item = JSON.parse(localStorage.getItem(userid));
            item.password = password
            localStorage.setItem(userid, JSON.stringify(item));
            //输出成功信息
            document.getElementById('success-message').textContent = '密码修改成功';
            //清除resetPassword
            localStorage.removeItem('resetPassword');
            //1秒后跳转到登录页面
            setTimeout(() => {
                window.location.href = 'login.html';
            }, 1000);
        });
    </script>
</body>
</html>